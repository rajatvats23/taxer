<!-- src/app/components/tax-calculator.component.html -->
<div class="calculator-container">
  <mat-card>
    <mat-card-header>
      <mat-card-title>Tax Calculator</mat-card-title>
    </mat-card-header>
    
    <mat-card-content>
      <form [formGroup]="taxForm" (ngSubmit)="calculate()">
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Annual Income (₹)</mat-label>
          <input matInput type="number" formControlName="income" placeholder="Enter income">
          @if (taxForm.get('income')?.invalid && taxForm.get('income')?.touched) {
            <mat-error>Please enter a valid income</mat-error>
          }
        </mat-form-field>

        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Age</mat-label>
          <input matInput type="number" formControlName="age" placeholder="Enter age">
          @if (taxForm.get('age')?.invalid && taxForm.get('age')?.touched) {
            <mat-error>Please enter a valid age (0-120)</mat-error>
          }
        </mat-form-field>

        <div class="button-group">
          <button mat-raised-button color="primary" type="submit">Calculate Tax</button>
          <button mat-raised-button type="button" (click)="reset()">Reset</button>
        </div>
      </form>

      @if (error()) {
        <mat-card class="error-card">
          {{ error() }}
        </mat-card>
      }

      @if (result()) {
        <mat-card class="result-card">
          <mat-card-header>
            <mat-card-title>Tax Calculation Result</mat-card-title>
          </mat-card-header>
          <mat-card-content>
            <div class="result-summary">
              <p><strong>Total Tax:</strong> ₹{{ result()!.totalTax | number:'1.2-2' }}</p>
              <p><strong>Effective Rate:</strong> {{ result()!.effectiveRate | number:'1.2-2' }}%</p>
            </div>

            @if (result()!.breakdown.length > 0) {
              <div class="breakdown">
                <h4>Tax Breakdown</h4>
                <table>
                  <thead>
                    <tr>
                      <th>Income Range</th>
                      <th>Tax Rate</th>
                      <th>Taxable Amount</th>
                      <th>Tax</th>
                    </tr>
                  </thead>
                  <tbody>
                    @for (item of result()!.breakdown; track item.slab.id) {
                      <tr>
                        <td>₹{{ item.slab.minIncome | number }} - ₹{{ item.slab.maxIncome | number }}</td>
                        <td>{{ item.slab.taxRate }}%</td>
                        <td>₹{{ item.taxableAmount | number:'1.2-2' }}</td>
                        <td>₹{{ item.taxAmount | number:'1.2-2' }}</td>
                      </tr>
                    }
                  </tbody>
                </table>
              </div>
            }
          </mat-card-content>
        </mat-card>
      }
    </mat-card-content>
  </mat-card>
</div>